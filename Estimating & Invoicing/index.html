<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLR Internal Estimator</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        jlrNavy: '#1B365D',
                        jlrGold: '#D4AF37',
                        jlrBeige: '#F5F5DC',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- jsPDF & AutoTable for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- ICONS (SVG) ---
        const PlusIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        );
        const TrashIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
        );
        const DownloadIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        );

        // --- PDF GENERATOR LOGIC ---
        const generatePDF = (data) => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const NAVY = '#1B365D';
            const GOLD = '#D4AF37';

            const { clientName, clientAddress, date, items, type, invoiceNumber } = data;

            // 1. Header Background
            doc.setFillColor(NAVY);
            doc.rect(0, 0, 210, 40, 'F');

            // 2. Company Name
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont('helvetica', 'bold');
            doc.text("JLR-PNG BUILDER'S LIMITED", 15, 18);

            // 3. Gold Line
            doc.setDrawColor(GOLD);
            doc.setLineWidth(1);
            doc.line(15, 23, 110, 23);

            // 4. Contact Details
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text("P.O Box 2355, Lae, Morobe Province", 15, 29);
            doc.text("Ph: (+675) 70029811 | jlr.pngbuilders@gmail.com", 15, 34);

            // 5. Doc Type & Date
            doc.setFontSize(16);
            doc.text(type.toUpperCase(), 195, 18, { align: 'right' });
            doc.setFontSize(10);
            doc.text(`#${invoiceNumber}`, 195, 25, { align: 'right' });
            doc.text(date, 195, 30, { align: 'right' });

            // 6. Client Info
            doc.setTextColor(0, 0, 0);
            doc.setFont('helvetica', 'bold');
            doc.text("BILL TO:", 15, 55);
            doc.setFont('helvetica', 'normal');
            doc.text(clientName, 15, 60);
            
            // Handle multi-line address
            const splitAddress = doc.splitTextToSize(clientAddress || '', 80);
            doc.text(splitAddress, 15, 65);

            // 7. Table
            const tableRows = items.map(item => [
                item.description,
                item.quantity,
                `K${parseFloat(item.price).toFixed(2)}`,
                `K${(item.quantity * item.price).toFixed(2)}`
            ]);

            doc.autoTable({
                head: [["Description", "Qty", "Unit Price", "Total"]],
                body: tableRows,
                startY: 85,
                theme: 'grid',
                headStyles: { fillColor: NAVY, textColor: 255, fontStyle: 'bold' },
                styles: { lineColor: [200, 200, 200], lineWidth: 0.1 },
            });

            // 8. Grand Total
            const finalY = doc.lastAutoTable.finalY + 10;
            const grandTotal = items.reduce((acc, item) => acc + (item.quantity * item.price), 0);
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text(`TOTAL AMOUNT: K${grandTotal.toFixed(2)}`, 195, finalY, { align: 'right' });

            // 9. Footer
            const pageHeight = doc.internal.pageSize.height;
            doc.setDrawColor(200, 200, 200);
            doc.line(10, pageHeight - 15, 200, pageHeight - 15);
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            // UPDATED FOOTER TEXT IN PDF
            doc.text("Powered by JA'Studio", 105, pageHeight - 8, { align: 'center' });

            // Save
            doc.save(`JLR_${type}_${clientName.replace(/\s+/g, '_') || 'Draft'}.pdf`);
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
            const [formData, setFormData] = useState({
                type: 'Estimate',
                invoiceNumber: 'INV-' + Math.floor(1000 + Math.random() * 9000),
                date: new Date().toISOString().split('T')[0],
                clientName: '',
                clientAddress: '',
            });

            const [items, setItems] = useState([
                { description: '', quantity: 1, price: 0 }
            ]);

            const handleInputChange = (e) => {
                setFormData({ ...formData, [e.target.name]: e.target.value });
            };

            const handleItemChange = (index, field, value) => {
                const newItems = [...items];
                newItems[index][field] = value;
                setItems(newItems);
            };

            const addItem = () => setItems([...items, { description: '', quantity: 1, price: 0 }]);
            const removeItem = (index) => setItems(items.filter((_, i) => i !== index));

            const calculateTotal = () => items.reduce((acc, item) => acc + (item.quantity * item.price), 0);

            return (
                <div className="min-h-screen bg-gray-50 font-sans flex flex-col">
                    
                    {/* Header */}
                    <header className="bg-jlrNavy text-white shadow-lg">
                        <div className="max-w-4xl mx-auto px-6 py-4 flex justify-between items-center">
                            <div>
                                <h1 className="text-2xl font-bold tracking-tight">JLR INTERNAL TOOL</h1>
                                <p className="text-jlrGold text-xs uppercase tracking-widest">Estimating & Invoicing</p>
                            </div>
                            <div className="hidden md:block text-right text-xs opacity-70">
                                Internal Version 1.0
                            </div>
                        </div>
                    </header>

                    {/* Main Form Area */}
                    <main className="flex-grow max-w-4xl mx-auto w-full px-4 py-8">
                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                            
                            {/* Top Controls */}
                            <div className="bg-gray-50 px-6 py-6 border-b border-gray-200 grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Doc Type</label>
                                    <select 
                                        name="type" 
                                        value={formData.type} 
                                        onChange={handleInputChange}
                                        className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-jlrNavy outline-none"
                                    >
                                        <option value="Estimate">Estimate</option>
                                        <option value="Invoice">Invoice</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Ref Number</label>
                                    <input 
                                        type="text" 
                                        name="invoiceNumber"
                                        value={formData.invoiceNumber}
                                        onChange={handleInputChange}
                                        className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-jlrNavy outline-none"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Date</label>
                                    <input 
                                        type="date" 
                                        name="date"
                                        value={formData.date}
                                        onChange={handleInputChange}
                                        className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-jlrNavy outline-none"
                                    />
                                </div>
                            </div>

                            {/* Client Section */}
                            <div className="px-6 py-6">
                                <h3 className="text-jlrNavy font-bold mb-4 border-b border-gray-100 pb-2">Client Details</h3>
                                <div className="grid gap-4">
                                    <input 
                                        placeholder="Client Company Name"
                                        name="clientName"
                                        value={formData.clientName}
                                        onChange={handleInputChange}
                                        className="w-full p-3 border border-gray-300 rounded focus:border-jlrGold outline-none transition-colors"
                                    />
                                    <textarea 
                                        placeholder="Client Address (P.O Box, City, Province)"
                                        name="clientAddress"
                                        value={formData.clientAddress}
                                        onChange={handleInputChange}
                                        rows="2"
                                        className="w-full p-3 border border-gray-300 rounded focus:border-jlrGold outline-none resize-none transition-colors"
                                    />
                                </div>
                            </div>

                            {/* Line Items Section */}
                            <div className="px-6 py-6 bg-gray-50">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-jlrNavy font-bold">Line Items</h3>
                                    <button 
                                        onClick={addItem}
                                        className="text-sm bg-white border border-gray-300 px-3 py-1 rounded text-jlrNavy hover:text-jlrGold hover:border-jlrGold transition-all flex items-center gap-1 font-semibold shadow-sm"
                                    >
                                        <PlusIcon /> Add Item
                                    </button>
                                </div>

                                <div className="space-y-3">
                                    {items.map((item, index) => (
                                        <div key={index} className="flex gap-2 items-start group">
                                            <input 
                                                placeholder="Description"
                                                value={item.description}
                                                onChange={(e) => handleItemChange(index, 'description', e.target.value)}
                                                className="flex-grow p-2 border border-gray-300 rounded focus:border-jlrNavy outline-none"
                                            />
                                            <input 
                                                type="number"
                                                placeholder="Qty"
                                                value={item.quantity}
                                                onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}
                                                className="w-16 p-2 border border-gray-300 rounded text-center focus:border-jlrNavy outline-none"
                                            />
                                            <input 
                                                type="number"
                                                placeholder="Price"
                                                value={item.price}
                                                onChange={(e) => handleItemChange(index, 'price', Number(e.target.value))}
                                                className="w-24 p-2 border border-gray-300 rounded text-right focus:border-jlrNavy outline-none"
                                            />
                                            <button 
                                                onClick={() => removeItem(index)}
                                                className="p-2 text-gray-400 hover:text-red-500 transition-colors"
                                            >
                                                <TrashIcon />
                                            </button>
                                        </div>
                                    ))}
                                </div>

                                <div className="mt-8 flex justify-end items-center gap-4 border-t border-gray-200 pt-4">
                                    <span className="text-gray-500 font-bold uppercase text-sm">Total Amount</span>
                                    <span className="text-3xl font-bold text-jlrNavy">
                                        K{calculateTotal().toFixed(2)}
                                    </span>
                                </div>
                            </div>

                            {/* Generate Button */}
                            <div className="px-6 py-6 bg-gray-100 border-t border-gray-200 flex justify-end">
                                <button 
                                    onClick={() => generatePDF({...formData, items})}
                                    className="bg-jlrNavy hover:bg-blue-900 text-white px-8 py-3 rounded shadow-lg hover:shadow-xl transition-all font-bold flex items-center gap-2 transform active:scale-95"
                                >
                                    <DownloadIcon />
                                    Generate {formData.type} PDF
                                </button>
                            </div>
                        </div>
                    </main>

                    {/* Footer */}
                    <footer className="py-6 text-center text-gray-400 text-sm pb-8">
                        <div className="inline-flex items-center gap-2 px-3 py-1 rounded bg-white shadow-sm border border-gray-200">
                            <span>Powered by</span>
                            {/* UPDATED FOOTER TEXT IN UI */}
                            <span className="bg-black text-white px-1.5 py-0.5 rounded text-xs font-mono font-bold">
                                JA'Studio
                            </span>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>